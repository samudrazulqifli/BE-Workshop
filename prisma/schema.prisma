generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  MECHANIC
  ADMIN
}

enum VehicleType {
  MOTOR
  MOBIL
}

enum ConsultationStatus {
  PENDING
  PAID
  ACTIVE
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

enum MessageType {
  TEXT
  IMAGE
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String   @map("password_hash")
  role         Role     @default(USER)
  name         String
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  mechanic      Mechanic?
  vehicles      Vehicle[]
  consultations Consultation[]
  payments      Payment[]
  reviews       Review[]
  messages      Message[]
  adminLogs     AdminLog[]

  @@map("users")
}

model Mechanic {
  id              String   @id @default(uuid())
  userId          String   @unique @map("user_id")
  description     String?
  consultationFee Int      @default(0) @map("consultation_fee")
  isVerified      Boolean  @default(false) @map("is_verified")
  isOnline        Boolean  @default(false) @map("is_online")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  user          User                 @relation(fields: [userId], references: [id])
  specialties   MechanicSpecialty[]
  consultations Consultation[]
  wallet        MechanicWallet?
  reviews       Review[]

  @@map("mechanics")
}

model MechanicSpecialty {
  id         String @id @default(uuid())
  mechanicId String @map("mechanic_id")
  specialty  String

  mechanic Mechanic @relation(fields: [mechanicId], references: [id])

  @@map("mechanic_specialties")
}

model Vehicle {
  id        String      @id @default(uuid())
  userId    String      @map("user_id")
  type      VehicleType
  brand     String
  model     String
  year      Int
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")

  user          User           @relation(fields: [userId], references: [id])
  consultations Consultation[]

  @@map("vehicles")
}

model Consultation {
  id                 String             @id @default(uuid())
  userId             String             @map("user_id")
  mechanicId         String             @map("mechanic_id")
  vehicleId          String             @map("vehicle_id")
  problemDescription String             @map("problem_description")
  status             ConsultationStatus @default(PENDING)
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")

  user        User                      @relation(fields: [userId], references: [id])
  mechanic    Mechanic                  @relation(fields: [mechanicId], references: [id])
  vehicle     Vehicle                   @relation(fields: [vehicleId], references: [id])
  attachments ConsultationAttachment[]
  messages    Message[]
  payment     Payment?
  review      Review?

  @@map("consultations")
}

model ConsultationAttachment {
  id             String   @id @default(uuid())
  consultationId String   @map("consultation_id")
  fileUrl        String   @map("file_url")
  createdAt      DateTime @default(now()) @map("created_at")

  consultation Consultation @relation(fields: [consultationId], references: [id])

  @@map("consultation_attachments")
}

model Message {
  id             String      @id @default(uuid())
  consultationId String      @map("consultation_id")
  senderId       String      @map("sender_id")
  messageType    MessageType @map("message_type")
  content        String
  createdAt      DateTime    @default(now()) @map("created_at")

  consultation Consultation @relation(fields: [consultationId], references: [id])
  sender       User         @relation(fields: [senderId], references: [id])

  @@map("messages")
}

model Payment {
  id             String        @id @default(uuid())
  consultationId String        @unique @map("consultation_id")
  userId         String        @map("user_id")
  amount         Int
  status         PaymentStatus @default(PENDING)
  paymentMethod  String?       @map("payment_method")
  createdAt      DateTime      @default(now()) @map("created_at")

  consultation Consultation @relation(fields: [consultationId], references: [id])
  user         User         @relation(fields: [userId], references: [id])

  @@map("payments")
}

model MechanicWallet {
  id         String   @id @default(uuid())
  mechanicId String   @unique @map("mechanic_id")
  balance    Int      @default(0)
  updatedAt  DateTime @updatedAt @map("updated_at")

  mechanic Mechanic @relation(fields: [mechanicId], references: [id])

  @@map("mechanic_wallets")
}

model Review {
  id             String   @id @default(uuid())
  consultationId String   @unique @map("consultation_id")
  userId         String   @map("user_id")
  mechanicId     String   @map("mechanic_id")
  rating         Int
  comment        String?
  createdAt      DateTime @default(now()) @map("created_at")

  consultation Consultation @relation(fields: [consultationId], references: [id])
  user         User         @relation(fields: [userId], references: [id])
  mechanic     Mechanic     @relation(fields: [mechanicId], references: [id])

  @@map("reviews")
}

model AdminLog {
  id        String   @id @default(uuid())
  adminId   String   @map("admin_id")
  action    String
  targetId  String?  @map("target_id")
  createdAt DateTime @default(now()) @map("created_at")

  admin User @relation(fields: [adminId], references: [id])

  @@map("admin_logs")
}
